<ion-content style="--background: #0b0e11;">
  <div class="fintech-container">

    <div class="map-card-top">
      <div class="card-title total_embalses">
        <ion-icon name="rainy-outline"></ion-icon>
        <span>Precipitaciones últimas 24h</span>
        <div class="time-filters">
          <button [class.active]="mapaMeteorologico.rango === '1 day'"
                  (click)="mapaMeteorologico.cargarDatosEstaciones()">1d</button>
          <button [class.active]="mapaMeteorologico.rango === '1 week'"
                  (click)="mapaMeteorologico.mostrarHistoricoPrecipitaciones('1 week')">7d</button>
          <button [class.active]="mapaMeteorologico.rango === '1 month'"
                  (click)="mapaMeteorologico.mostrarHistoricoPrecipitaciones('1 month')">1m</button>
          <button [class.active]="mapaMeteorologico.rango === '3 months'"
                  (click)="mapaMeteorologico.mostrarHistoricoPrecipitaciones('3 months')">3m</button>
          <button [class.active]="mapaMeteorologico.rango === '6 months'"
                  (click)="mapaMeteorologico.mostrarHistoricoPrecipitaciones('6 months')">6m</button>
          <button [class.active]="mapaMeteorologico.rango === '1 year'"
                  (click)="mapaMeteorologico.mostrarHistoricoPrecipitaciones('1 year')">1A</button>
        </div>
      </div>

      <div class="map-wrapper">
        <app-meteorology-map #mapaMeteorologico></app-meteorology-map>
      </div>
    </div>

    <div class="chart-main-card">
      <div class="chart-header">
        <div class="info">
          <div class="card-title total_embalses">
            <div class="modern-reservoir">
              <div class="water-fill" [style.height.%]="porcentajeTotalHeader">
                <div class="wave"></div>
              </div>
            </div>
            <span>Volumen Total Cuenca del Segura</span>
          </div>
          <div class="main-value">
            {{ volumenTotalHeader | number:'1.2-2' }} <span>hm³</span>
            <small [class]="tendenciaPositiva ? 'variation positive' : 'variation negative'">
              {{ tendenciaPositiva ? '+' : '' }}{{ variacionVolumenTotal | number:'1.2-2' }}hm3
            </small>
          </div>
          <div class="main-value">
            {{ porcentajeTotalHeader | number:'1.2-2' }} <span>%</span>
            <small [class]="tendenciaPositiva ? 'variation positive' : 'variation negative'">
              {{ tendenciaPositiva ? '+' : '' }}{{ variacionPorcentajeTotalHeader | number:'1.2-2' }}%
            </small>
          </div>
        </div>
        <div class="time-filters">
          <button (click)="updateChart('1D')" [class.active]="filter === '1D'">1D</button>
          <button (click)="updateChart('1S')" [class.active]="filter === '1S'">1S</button>
          <button (click)="updateChart('1M')" [class.active]="filter === '1M'">1M</button>
          <button (click)="updateChart('3M')" [class.active]="filter === '3M'">3M</button>
          <button (click)="updateChart('YTD')" [class.active]="filter === 'YTD'" class="hide-mobile">YTD</button>
          <button (click)="updateChart('1A')" [class.active]="filter === '1A'">1A</button>
          <button (click)="updateChart('2A')" [class.active]="filter === '2A'" class="hide-mobile">2A</button>
          <button (click)="updateChart('3A')" [class.active]="filter === '3A'">3A</button>
          <button (click)="updateChart('5A')" [class.active]="filter === '5A'">5A</button>
          <button (click)="updateChart('10A')" [class.active]="filter === '10A'">10A</button>
          <button (click)="updateChart('ALL')" [class.active]="filter === 'ALL'">ALL</button>
        </div>
      </div>
      <div class="chart-body">
        <canvas id="evolutionChart"></canvas>
      </div>
    </div>
    <div class="cards-wrapper">
      <div class="fintech-card">
        <div class="card-title subidas">
          <ion-icon name="trending-up-outline"></ion-icon>
          <span>Top 5 Subidas</span>
        </div>
        <div class="time-filters">
          <button (click)="cargarSeccion('1 day', 'subidas')" [class.active]="filtroSubidas === '1 day'">1D</button>
          <button (click)="cargarSeccion('7 days', 'subidas')" [class.active]="filtroSubidas === '7 days'">7D</button>
          <button (click)="cargarSeccion('14 days', 'subidas')" [class.active]="filtroSubidas === '14 days'">14D</button>
          <button (click)="cargarSeccion('1 month', 'subidas')" [class.active]="filtroSubidas === '1 month'">1M</button>
          <button (click)="cargarSeccion('3 month', 'subidas')" [class.active]="filtroSubidas === '3 month'">3M</button>
          <button (click)="cargarSeccion('1 year', 'subidas')" [class.active]="filtroSubidas === '1 year'">1A</button>
        </div>
        <div class="header-row">
          <span class="label-nombre">Embalse</span>
          <span class="label-porcentaje">Porcentaje</span>
          <span class="label-stats">Volumen</span>
        </div>
        <div *ngFor="let e of topSubidas; let i = index" class="fintech-row">
          <div class="info-group">
            <div class="rank">{{ i + 1 }}</div>
            <span class="nombre" (click)="abrirHistoricoEmbalse(e.idEmbalse)">
              {{ e.nombre }}
            </span>
          </div>
          <div class="center-pill">
            <span class="porcentaje-badge">{{ e.porcentaje | number:'1.1-1' }}%</span>
          </div>
          <div class="stats">
            <span class="volumen">{{ e.volumen | number:'1.2-2' }} <small>hm³</small></span>
            <span class="badge positive">+{{ e.variacion | number:'1.3-3' }}</span>
          </div>
        </div>
      </div>
      <div class="fintech-card">
        <div class="card-title bajadas">
          <ion-icon name="trending-down-outline"></ion-icon>
          <span>Top 5 Bajadas</span>
        </div>
        <div class="time-filters">
          <button (click)="cargarSeccion('1 day', 'bajadas')" [class.active]="filtroBajadas === '1 day'">1D</button>
          <button (click)="cargarSeccion('7 days', 'bajadas')" [class.active]="filtroBajadas === '7 days'">7D</button>
          <button (click)="cargarSeccion('14 days', 'bajadas')" [class.active]="filtroBajadas === '14 days'">14D</button>
          <button (click)="cargarSeccion('1 month', 'bajadas')" [class.active]="filtroBajadas === '1 month'">1M</button>
          <button (click)="cargarSeccion('3 month', 'bajadas')" [class.active]="filtroBajadas === '3 month'">3M</button>
          <button (click)="cargarSeccion('1 year', 'bajadas')" [class.active]="filtroBajadas === '1 year'">1A</button>
        </div>
        <div class="header-row">
          <span class="label-nombre">Embalse</span>
          <span class="label-porcentaje">Porcentaje</span>
          <span class="label-stats">Volumen</span>
        </div>
        <div *ngFor="let e of topBajadas; let i = index" class="fintech-row">
          <div class="info-group">
            <div class="rank">{{ i + 1 }}</div>
            <span class="nombre" (click)="abrirHistoricoEmbalse(e.idEmbalse)">
              {{ e.nombre }}
            </span>
          </div>
          <div class="center-pill">
            <span class="porcentaje-badge">{{ e.porcentaje | number:'1.1-1' }}%</span>
          </div>
          <div class="stats">
            <span class="volumen">{{ e.volumen | number:'1.2-2' }} <small>hm³</small></span>
            <span class="badge negative">{{ e.variacion | number:'1.3-3' }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="cards-wrapper">
      <div class="fintech-card">
        <div class="card-title total_embalses">
          <ion-icon name="water-outline"></ion-icon>
          <span>Estado Embalses Individual</span>
        </div>
        <div class="time-filters">
          <button (click)="cargarSeccion('1 day', 'individual')" [class.active]="filtroIndividual === '1 day'">1D</button>
          <button (click)="cargarSeccion('7 days', 'individual')" [class.active]="filtroIndividual === '7 days'">7D</button>
          <button (click)="cargarSeccion('14 days', 'individual')" [class.active]="filtroIndividual === '14 days'">14D</button>
          <button (click)="cargarSeccion('1 month', 'individual')" [class.active]="filtroIndividual === '1 month'">1M</button>
          <button (click)="cargarSeccion('3 month', 'individual')" [class.active]="filtroIndividual === '3 month'">3M</button>
          <button (click)="cargarSeccion('1 year', 'individual')" [class.active]="filtroIndividual === '1 year'">1A</button>
        </div>
        <div class="header-row">
          <span class="label-nombre">Embalse</span>
          <span class="label-porcentaje">Porcentaje</span>
          <span class="label-stats">Volumen</span>
        </div>
        <div *ngFor="let e of embalses; let i = index" class="fintech-row">
          <div class="info-group">
            <div class="rank">{{ i + 1 }}</div>
            <span class="nombre" (click)="abrirHistoricoEmbalse(e.idEmbalse)">
              {{ e.nombre }}
            </span>
          </div>
          <div class="center-pill">
            <span class="porcentaje-badge">{{ e.porcentaje | number:'1.1-1' }}%</span>
          </div>
          <div class="stats">
            <span class="volumen">{{ e.volumen | number:'1.2-2' }} <small>hm³</small></span>
            <span class="badge" [class.positive]="e.variacion >= 0" [class.negative]="!(e.variacion >= 0)">
              {{ e.variacion > 0 ? '+' : '' }}{{ e.variacion | number:'1.3-3' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>